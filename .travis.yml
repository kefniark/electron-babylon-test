os: osx
osx_image: xcode9.3
language: node_js
node_js: "10"

env:
  - ELECTRON_CACHE=$HOME/.cache/electron
  - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder

cache:
  directories:
  - node_modules
  - app/node_modules
  - $HOME/.cache/electron
  - $HOME/.cache/electron-builder

stages:
  - test
    if: tag IS blank
  - build
    if: branch = master AND tag IS blank

jobs:
  include:
    - stage: test
      script:
        - npm install
        - npm run test
    - stage: build
      script:
        - npm run package-linux-mac